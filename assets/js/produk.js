var data = [
	{
        "id":"0",
        "nama": "Benih mentimun hibrida F1 MIRA dari PT.AGRI MAKMUR PERTIWI. isi 25gram",
        "kategori": "Benih",
        "deskripsi": "Buah berwarna  hijau gelap dan tidak pahit. Bentuk buah silindris, panjang 22 – 24 cm dan diameter ± 5 cm. Jumlah buah per tanaman 14 – 18, berat buah 250 – 300 gram. Potensi hasil bisa mencapai 52,5 – 75,6 ton/ha. Dapat dipanen mulai umur 33 – 35 hari setelah pindah tanam. Lebih tahan virus.",
        "link": "produk-link1",
        "foto": "https://cf.shopee.co.id/file/32e85d930ae5924cbe917c763bd58896",
        "marketplace": "https://shopee.co.id/product/231758580/4619820005?smtt=0.99855215-1654831771.9",
        "stok":"5",
        "harga":"55000",
        "ongkir":"10000"
    },
    {
        "id":"1",
        "nama": "Fungisida Sistemik DIMORF 500 SC . Isi 250ml dari Mitra Agro Sukses",
        "kategori": "Fungisida",
        "deskripsi": "Fungisida Sistemik DIMORF 500 SC . Isi 250ml dari Mitra Agro Sukses. Fungisida sistemik berbentuk pekatan suspensi berwarna putih untuk mengendalikan penyakit bulai, penyakit busuk daun atau akar pada tanaman dengan cara perlakuan benih ataupun dengan spray.",
        "link": "produk-link1",
        "foto": "https://cf.shopee.co.id/file/31300d9ebdf6139871a292b0f3e1306a",
        "marketplace": "https://shopee.co.id/Fungisida-Sistemik-DIMORF-500-SC-.-Isi-250ml-dari-Mitra-Agro-Sukses-i.231758580.3358184511?xptdk=83db757e-72bb-4163-821c-350ccb752b16",
        "stok":"5",
        "harga":"35000",
        "ongkir":"5000"
    },
    {
        "id":"2",
        "nama": "Benih Paria/Pare TANJUNG 11 F1 isi 10gr dari MITRA MERDEKA TANI",
        "kategori": "Benih",
        "deskripsi": "Paria f1 dengan tipe pertumbuhan merambat. Cocok untuk dataran rendah. Pertumbuhan vigor dan sangat produktif. Bentuk buah silindris dengan warana kulit hijau gelap. Permukaan buah bergerigi, daging tebal, rasa buah sedikit pahit. Panjang buah 𝟐𝟎 - 𝟑𝟎 𝐜𝐦, diameter 𝟕 - 𝟖 𝐜𝐦, bobot perbuah 𝟐𝟓𝟎 - 𝟑𝟎𝟎 𝐠𝐫. Panen Umur 𝟒𝟐 𝐇𝐒𝐓 dengan potensi hasil 𝟐𝟓 - 𝟑𝟎 𝐭𝐨𝐧 per hektar.",
        "link": "produk-link1",
        "foto": "https://cf.shopee.co.id/file/ae0ee0a5cd3afdd4f3c9b98bb6665c1d",
        "marketplace": "https://shopee.co.id/Benih-Paria-Pare-TANJUNG-11-F1-isi-10gr-dari-MITRA-MERDEKA-TANI-i.231758580.8298439898?xptdk=36f95791-a295-480b-b2e7-68b6ebd61b8a",
        "stok":"9",
        "harga":"30000",
        "ongkir":"7000"
    },
    {
        "id":"3",
        "nama": "Benih unggul gambas hibrida F1 LAMONA dari PERTIWI. Isi 10gram",
        "kategori": "Benih",
        "deskripsi": "Warna buah hijau. Pertumbuhan tanaman kokoh dan seragam. Berat buah 200-250 gram dengan potensi hasil banyak.",
        "link": "produk-link1",
        "foto": "https://cf.shopee.co.id/file/6c5dacc1757898ba94b6921f17f6c1db",
        "marketplace": "https://shopee.co.id/Benih-unggul-gambas-hibrida-F1-LAMONA-dari-PERTIWI.-Isi-10gram-i.231758580.4220325037?smtt=0.99855215-1654831771.9",
        "stok":"8",
        "harga":"25000",
        "ongkir":"5000"
    },
    {
        "id":"4",
        "nama": "Pupuk NPK Cair Tanigrow",
        "kategori": "Pupuk",
        "deskripsi": "Pupuk NPK CAIR TANIGROW adalah pupuk daun, bunga dan buah yang sangat efektif untuk merangsang pembentukan bunga dan menghasilkan biji yang bernas terutama pada tanaman kacang-kacangan. Pupuk ini juga mampu melipatgandakan hasil panen tanaman kacang hijau dan kedelai.",
        "link": "produk-link1",
        "foto": "https://saprotan-utama.com/wp-content/uploads/2020/11/46_Tanigrow-1-768x768.jpg",
        "marketplace": "https://saprotan-utama.com/product/tanigrow/",
        "stok":"7",
        "harga":"50000",
        "ongkir":"5000"
    },
    {
        "id":"5",
        "nama": "Alat pelubang/plong plastik mulsa nama bakar diameter 5,5 cm tinggi 70 cm",
        "kategori": "Alat",
        "deskripsi": "Alat pelubang/plong plastik mulsa nama bakar diameter 5,5 cm tinggi 70 cm",
        "link": "produk-link1",
        "foto": "https://cf.shopee.co.id/file/04760784fdb325cdf09e58891636087c",
        "marketplace": "https://shopee.co.id/Alat-pelubang-plong-plastik-mulsa-nama-bakar-diameter-5-5-cm-tinggi-70-cm-i.231758580.7782747359?xptdk=28e44b0a-8ad8-4053-8df1-c8892c3771e8",
        "stok":"2",
        "harga":"25000",
        "ongkir":"5000"
    },
    {
        "id":"6",
        "nama": "Tapetool, Hand Tying Machine - Alat Pengikat Lanjaran Tanaman",
        "kategori": "Alat",
        "deskripsi": "Tapetool adalah alat untuk mengikat tanaman pada ajir (penopang tanaman) atau tali rambatan. Biasanya digunakan untuk tanaman merambat seperti tomat, timun, anggur, dsb. Juga dapat digunakan pada tanaman lain yang membutuhkan penopang.",
        "link": "produk-link1",
        "foto": "https://cf.shopee.co.id/file/ef82e8418d064ccc738a9a6ef8a6bc4d",
        "marketplace": "https://shopee.co.id/Tapetool-Hand-Tying-Machine-Alat-Pengikat-Lanjaran-Tanaman-i.175498478.2782789037?sp_atk=f13a1cc0-4ac8-4a26-a416-2af1fcb0d632&xptdk=f13a1cc0-4ac8-4a26-a416-2af1fcb0d632",
        "stok":"3",
        "harga":"130000",
        "ongkir":"5000"
    },
    {
        "id":"7",
        "nama": "ROUNDUP 486SL HERBISIDA OBAT PEMBASMI RUMPUT LIAR & GULMA 200 ML",
        "kategori": "Pestisida",
        "deskripsi": "ROUNDUP 486 SL adalah herbisida populer dimana diformulasi dalam bentuk larutan yang mudah larut dalam air yang dapat mengendalikan gulma berdaun sempit, berdaun lebar dan teki-tekian. Diformulasikan dengan menggunakan teknologi biosorb.",
        "link": "produk-link1",
        "foto": "https://cf.shopee.co.id/file/9dc6d7425c53838f1241b12dc057d4f1",
        "marketplace": "https://shopee.co.id/ROUNDUP-486SL-HERBISIDA-OBAT-PEMBASMI-RUMPUT-LIAR-GULMA-200-ML-i.16443162.6009901425?xptdk=e2f3ac36-e2a7-4bd2-bdf9-2dce53671e8d",
        "stok":"9",
        "harga":"33000",
        "ongkir":"5000"
    },
    {
        "id":"8",
        "nama": "GRAMOXONE 276SL HERBISIDA RACUN PEMBASMI RUMPUT & GULMA 250 ML",
        "kategori": "Herbisida",
        "deskripsi": "GRAMOXONE 276SL 250 ML. Bahan Aktif: Parakuat Diklorida 276 g. Bentuk: larutan warna hijau tua (bersifat kontak). Diproduksi oleh : PT. SYNGENTA INDONESIA.",
        "link": "produk-link1",
        "foto": "https://cf.shopee.co.id/file/34e8eb31f01dfb2e7718ae98274b7c49",
        "marketplace": "https://shopee.co.id/GRAMOXONE-276SL-HERBISIDA-RACUN-PEMBASMI-RUMPUT-GULMA-250-ML-i.16443162.3910330101?xptdk=bdff72f1-c124-4ddb-9fdd-cd084ce39913",
        "stok":"8",
        "harga":"43000",
        "ongkir":"5000"
    }
];

var products = "",
	kategories = "";

for (var i = 0; i < data.length; i++) {
	var kategori = data[i].kategori,
		nama = data[i].nama,
		deskripsi = data[i].deskripsi,
		harga = data[i].harga,
		link = data[i].link,
		foto = data[i].foto,
		i = i;
	
	//create product cards
	products += "<div class='product' data-kategori='" + kategori + "' data-nama='" + nama + "' data-deskripsi='" + deskripsi + "' data-link='" + link + "'><a class='button-produk' href='"+ link +"' data-obj='"+ i +"'><div class='product-inner text-left'><img src='" + foto + "' width='100%' height='200px'><br /><div class='nama-produk'>" + nama + "</div><p style='color:red;display:flex;float:left;padding-left:8px;padding-top:5px;font-size:9pt'>Rp</p><div class='harga-produk'>" + harga + "</div></a></div></div>";
	
	//create dropdown of kategories
	if (kategories.indexOf("<option value='" + kategori + "'>" + kategori + "</option>") == -1) {
		kategories += "<option value='" + kategori + "'>" + kategori + "</option>";
	}
}

$("#products").html(products);
$(".filter-kategori").append(kategories);

var filtersObject = {};

//on filter change
$(".filter").on("change",function() {
	var filterName = $(this).data("filter"),
		filterVal = $(this).val();
	
	if (filterVal == "") {
		delete filtersObject[filterName];
	} else {
		filtersObject[filterName] = filterVal;
	}
	
	var filters = "";
	
	for (var key in filtersObject) {
	  	if (filtersObject.hasOwnProperty(key)) {
			filters += "[data-"+key+"='"+filtersObject[key]+"']";
	 	}
	}
	
	if (filters == "") {
		$(".product").show();
	} else {
		$(".product").hide();
		$(".product").hide().filter(filters).show();
	}
});

//on search form submit
$("#search-form").submit(function(e) {
	e.preventDefault();
	var query = $("#search-form input").val().toLowerCase();

	$(".product").hide();
	$(".product").each(function() {
		var kategori = $(this).data("nama").toLowerCase();

		if (kategori.indexOf(query) > -1) {
			$(this).show();
		}
	});
});

$(document).ready(function(){

      var list = $("#products .product");
      var numToShow = 4;
      var button = $("#produk-lainnya");
      var numInList = list.length;
      list.hide();
      if (numInList > numToShow) {
        button.show();
      }
      list.slice(0, numToShow).show();

      button.click(function(){
          var showing = list.filter(':visible').length;
          list.slice(showing - 1, showing + numToShow).fadeIn();
          var nowShowing = list.filter(':visible').length;
          if (nowShowing >= numInList) {
            button.hide();
          }
      });

});

var dataLength = data.length;
var thisElement2 = 0;

function innerContent2(content){
  $(".inner-title-produk").html(data[content].nama);
  $(".inner-foto-produk").attr("src",data[content].foto);
  $(".inner-marketplace").attr("href",data[content].marketplace);
  $(".inner-checkout").attr("href",data[content].checkout);
  $(".inner-obj").attr("data-obj",data[content].id);
  $(".inner-deskripsi").html(data[content].deskripsi);
  $(".inner-stok").html(data[content].stok);
  $(".inner-harga").html(data[content].harga);
  $(".inner-kategori").html(data[content].kategori);
};

var thisElement3 = 0;

function innerContent3(content){
  $(".inner-nama-produk").attr("value",data[content].nama);
  $(".inner-harga-produk").attr("value",data[content].harga);
  $(".inner-ongkir-produk").attr("value",data[content].ongkir);
};

//Open post:
$(".button-produk").click(function(e){
  e.preventDefault();
  thisElement2 = $(this).attr("data-obj");
  innerContent2(thisElement2);
  $("#products").css({"display":"none"});
  $("#search").css({"display":"none"});
  $("#filter").css({"display":"none"});
  $("#judul-home").css({"display":"none"});
  $("#judul-detail").css({"display":"block"});
  $("#produk-lainnya").css({"display":"none"});
  $("#detail-produk").css({"display":"block"});
});

//Open post:
$(".btn-checkout").click(function(e){
  e.preventDefault();
  thisElement3 = $(this).attr("data-obj");
  innerContent3(thisElement3);
  $("#products").css({"display":"none"});
  $("#search").css({"display":"none"});
  $("#filter").css({"display":"none"});
  $("#judul-home").css({"display":"none"});
  $("#judul-detail").css({"display":"none"});
  $("#produk-lainnya").css({"display":"none"});
  $("#detail-produk").css({"display":"none"});
  $("#judul-checkout").css({"display":"block"});
  $("#checkout-produk").css({"display":"block"});
});

$(".prev-produk").on("click", function() {
    $(window).scrollTop(0);
});

$(".next-produk").on("click", function() {
    $(window).scrollTop(0);
});

$(".close-produk").on("click", function() {
    $(window).scrollTop(0);
});

$(".btn-order").on("click", function() {
    $(window).scrollTop(0);
});

$(".product").on("click", function() {
    $(window).scrollTop(0);
});

$(".close-checkout").on("click", function() {
    $(window).scrollTop(0);
});

//Close post:
$(".close-produk").click(function(){
  $("#products").css({"display":"block"});
  $("#search").css({"display":"block"});
  $("#filter").css({"display":"block"});
  $("#produk-lainnya").css({"display":"block"});
  $("#detail-produk").css({"display":"none"});
  $("#judul-home").css({"display":"block"});
  $("#judul-detail").css({"display":"none"});
  $("#products").css({"display":"grid"});
  $("#products").css({"grid-template-rows":"285px auto"});
  $("#products").css({"grid-template-columns":"50% auto"});
  $("#products").css({"grid-row-gap":"10px"});
  $("#products").css({"grid-column-gap":"10px"});
  $("#peta-pertanian").css({"display":"none"});
  $("#judul-awal").css({"display":"none"});
});

$(".close-checkout").click(function(){
  $("#products").css({"display":"block"});
  $("#search").css({"display":"block"});
  $("#filter").css({"display":"block"});
  $("#produk-lainnya").css({"display":"block"});
  $("#detail-produk").css({"display":"none"});
  $("#judul-home").css({"display":"block"});
  $("#judul-detail").css({"display":"none"});
  $("#products").css({"display":"grid"});
  $("#products").css({"grid-template-rows":"285px auto"});
  $("#products").css({"grid-template-columns":"50% auto"});
  $("#products").css({"grid-row-gap":"10px"});
  $("#products").css({"grid-column-gap":"10px"});
  $("#peta-pertanian").css({"display":"none"});
  $("#judul-awal").css({"display":"none"});
  $("#judul-checkout").css({"display":"none"});
  $("#checkout-produk").css({"display":"none"});
});

//Next post:
$(".next-produk").click(function(e){
  e.preventDefault();
  if (thisElement2<dataLength-1) {
    thisElement2 = parseInt(thisElement2) + 1;
    innerContent2(thisElement2);
    dissBtn();
  };
});

//Prev post:
$(".prev-produk").click(function(e){
  e.preventDefault();
  if (thisElement2>0) {
    thisElement2 = parseInt(thisElement2) - 1;
    innerContent2(thisElement2);
    dissBtn();
  };
});

//Button disable:
function dissBtn(){
  $(".prev-produk, .next-produk").removeClass("disabled");
  if (thisElement2<=0){
    $(".prev-produk").addClass("disabled");
  }
  else if (thisElement2>=dataLength-1){
    $(".next-produk").addClass("disabled");
  };
};

// Hide Header on on scroll down
var didScroll;
var lastScrollTop = 0;
var delta = 5;
var navbarHeight = $('footer').outerHeight();

$(window).scroll(function(event){
    didScroll = true;
});

setInterval(function() {
    if (didScroll) {
        hasScrolled();
        didScroll = false;
    }
}, 250);

const scriptURL = 'https://script.google.com/macros/s/AKfycbwd01WlUTn7N-Zt7YTiWu2Zgez8jSnIOzd-7MndXJACpqwgWCk/exec';
const form = document.forms['maspannn-form-order'];
const btnKirim = document.querySelector('.btn-kirim');
const btnLoading = document.querySelector('.btn-loading');
const myAlert = document.querySelector('.my-alert');

form.addEventListener('submit', (e) => {
  e.preventDefault();
  // ketika tombol submit diklik
  // tampilkan tombol loading, hilangkan tombol kirim
  btnLoading.classList.toggle('d-none');
  btnKirim.classList.toggle('d-none');
  fetch(scriptURL, { method: 'POST', body: new FormData(form) })
    .then((response) => {
      // tampilkan tombol kirim, hilangkan tombol loading
      btnLoading.classList.toggle('d-none');
      btnKirim.classList.toggle('d-none');
      // tampilkan alert
      myAlert.classList.toggle('d-none');
      // reset formnya
      form.reset();
      console.log('Success!', response);
    })
    .catch((error) => console.error('Error!', error.message));
});

$("#button-checkout").on("click", function() {
  /* Inputan Formulir */
  var input_produk      = $("#produk").val(),
      input_harga       = $("#total").val(),
      input_name        = $("#name").val(),
      input_phone       = $("#phone").val(),
      input_alamat      = $("#alamat").val(),
      input_description = $("#description").val();

  /* Pengaturan Whatsapp */
  var walink    = 'https://web.whatsapp.com/send',
      text      = 'Halo kak? Saya ingin memesan:',
      phone     = '628973771555',
      text_yes  = 'Pesanan Anda berhasil terkirim.',
      text_no   = 'Isilah formulir terlebih dahulu.';

  /* Smartphone Support */
  if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
      var walink = 'whatsapp://send';
  }

  if(input_produk === "" && input_harga === ""){
      /* Whatsapp URL */
      var checkout_whatsapp = walink + '?phone=' + phone + '&text=' + text + '%0A%0A' +
          '*Produk* : ' + input_produk + '%0A' +
          '*Total Pembayaran* : ' + input_harga + '%0A' +
          '*Nama* : ' + input_name + '%0A' +
          '*Nomor Hp* : ' + input_phone + '%0A' +
          '*Alamat* : ' + input_alamat + '%0A' +
          '*Catatan* : ' + input_description + '%0A';

      /* Whatsapp Window Open */
      window.open(checkout_whatsapp,'_blank');
      document.getElementById("text-info").innerHTML = '<div class="alert alert-success">'+text_yes+'</div>';
  } else {
      document.getElementById("text-info").innerHTML = '<div class="alert alert-danger">'+text_no+'</div>';
  }
});


$(document).ready(function() {
  $("#harga, #qty, #ongkir").on("change", function(e) {
    var item_harga = $('#harga').val();
    var item_qty = $("#qty").val();
    var item_ongkir = $("#ongkir").val();
    var total = Number(item_harga) * Number(item_qty) + Number(item_ongkir);

    totalnumber = $(".calculator-total");
    var countTo = total;

    if (isNaN(total)) {
      alert("Need to input only numbers");
      $(".calculator-total").text("0");
    } else {
      $({ countNum: totalnumber.text() }).animate(
        {
          countNum: countTo
        },

        {
          duration: 1000,
          easing: "linear",
          step: function() {
            totalnumber.text(Math.floor(this.countNum));
          },
          complete: function() {
            totalnumber.text((this.countNum).toLocaleString('ru'));
            //alert('finished');
          }
        }
      );
    };
  });
});